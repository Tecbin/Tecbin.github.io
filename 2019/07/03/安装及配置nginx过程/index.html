<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>安装nginx过程以及webdav | AOI SPACE</title><script src="https://cdn.bootcss.com/valine/1.4.4/Valine.min.js"></script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/atom-one-dark-reasonable.min.css"></head><body><header><nav><a href="/">Home</a><a href="/archives">Archives</a></nav></header><main><article><div id="post-bg"><div id="post-title"><div id="post-info"><span>date:<time datetime="2019-07-02T23:52:54.000Z" id="date"> 2019-07-03</time></span><br><span>updated:<time datetime="2019-08-22T00:13:18.173Z" id="updated"> 2019-08-22</time></span></div><h1>安装nginx过程以及webdav</h1><hr></div><div id="post-content"><h1 id="安装nginx过程以及webdav"><a href="#安装nginx过程以及webdav" class="headerlink" title="安装nginx过程以及webdav"></a>安装nginx过程以及webdav</h1><p>在docker上由于有endpoint只能暴露一个端口所以打算使用nginx进行代理</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>在ubuntu环境下首先需要</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update #精简版的系统需要安装sudo，vim等</span><br></pre></td></tr></table></figure>
<h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nginx #直接使用即可</span><br></pre></td></tr></table></figure>
<p>这几个位置需要注意：</p>
<p>/usr/sbin/nginx：主程序</p>
<p>/etc/nginx：存放配置文件</p>
<p>/usr/share/nginx：存放静态文件</p>
<p>/var/log/nginx：存放日志</p>
<p>运行之前用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t #检查/etc/nginx/nginx.conf是否有语法错误</span><br></pre></td></tr></table></figure>
<p>最后通过：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx &#123;start|stop|restart|reload|force-reload|status|configtest|rotate|upgrade&#125;的命令启动</span><br></pre></td></tr></table></figure>
<h2 id="HTTPs的简单配置"><a href="#HTTPs的简单配置" class="headerlink" title="HTTPs的简单配置"></a>HTTPs的简单配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /etc/nginx/sslcloud</span><br><span class="line">sudo openssl req -x509 -nodes -days 36500 -newkey rsa:2048 -keyout /etc/nginx/ssl/cloud/nginx.key -out /etc/nginx/ssl/cloud/nginx.crt</span><br><span class="line">#创建了有效期100年，加密强度为RSA2048的SSL密钥key和X509证书文件。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">步骤2： Configure Nginx to Use SSL</span><br><span class="line">首先配置HTTP请求重定向</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  www.yourdomain.com;</span><br><span class="line">        rewrite ^ https://$http_host$request_uri? permanent;    # force redirect http to https</span><br><span class="line">    #return 301 https://$http_host$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen 443 ssl;</span><br><span class="line"></span><br><span class="line">        ssl_certificate /etc/nginx/ssl/nginx.crt;</span><br><span class="line">        ssl_certificate_key /etc/nginx/ssl/nginx.key;</span><br><span class="line">    keepalive_timeout   70;</span><br><span class="line">        server_name www.yourdomain.com;</span><br><span class="line">    #禁止在header中出现服务器版本，防止黑客利用版本漏洞攻击</span><br><span class="line">    server_tokens off;</span><br><span class="line">    #如果是全站 HTTPS 并且不考虑 HTTP 的话，可以加入 HSTS 告诉你的浏览器本网站全站加密，并且强制用 HTTPS 访问</span><br><span class="line">    #add_header Strict-Transport-Security &quot;max-age=31536000; includeSubdomains&quot;;</span><br><span class="line">        # ......</span><br><span class="line">        fastcgi_param   HTTPS               on;</span><br><span class="line">        fastcgi_param   HTTP_SCHEME         https;</span><br><span class="line"></span><br><span class="line">    access_log      /var/log/nginx/wiki.domain.log</span><br><span class="line">        error_log       /var/log/nginx/wiki.domain.error.log;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">   ssl_certificate /etc/nginx/ssl/nginx.crt;</span><br><span class="line">   ssl_certificate_key /etc/nginx/ssl/nginx.key;</span><br><span class="line"></span><br><span class="line">keepalive_timeout   70;</span><br><span class="line">    server_name 127.0.0.1;</span><br><span class="line">server_tokens off;	 #禁止在header中出现服务器版本，防止黑客利用版本漏洞攻击</span><br><span class="line">	</span><br><span class="line">#如果是全站 HTTPS 并且不考虑 HTTP 的话，可以加入 HSTS 告诉你的浏览器本网站全站加密，并且强制用 HTTPS 访问</span><br><span class="line">#add_header Strict-Transport-Security &quot;max-age=31536000; includeSubdomains&quot;;</span><br><span class="line">    # ......</span><br><span class="line">   # fastcgi_param   HTTPS               on;</span><br><span class="line">   # fastcgi_param   HTTP_SCHEME         https;</span><br><span class="line"> location / &#123;</span><br><span class="line">    root   /var/www/html;</span><br><span class="line">    index  index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line">	access_log      /var/log/nginx/docker.momoe.win.access.log;</span><br><span class="line">    error_log       /var/log/nginx/docker.momoe.win.error.log;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    error_page 404 /404;</span><br><span class="line">    error_page 503 /503;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root /drive;</span><br><span class="line">        autoindex on;</span><br><span class="line">        dav_methods PUT DELETE MKCOL COPY MOVE;</span><br><span class="line">        dav_ext_methods PROPFIND OPTIONS;</span><br><span class="line">        create_full_put_path on;</span><br><span class="line">        dav_access user:rw group:r all:r;</span><br><span class="line">        auth_basic &amp;quot;Authorized Users Only&amp;quot;;</span><br><span class="line">        auth_basic_user_file /usr/lib/squid/passwd;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$ sudo cat &gt; /etc/nginx/conf.d/webdav.conf &lt; EOF</span><br><span class="line">server &#123;</span><br><span class="line">    listen 2666;</span><br><span class="line">    listen [::]:2666;</span><br><span class="line">	  autoindex on;</span><br><span class="line">	  charset utf-8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	# 账号认证</span><br><span class="line">    auth_basic              realm_name;</span><br><span class="line">    auth_basic_user_file    /etc/nginx/.passwords.list;</span><br><span class="line"></span><br><span class="line">    dav_methods     PUT DELETE MKCOL COPY MOVE;</span><br><span class="line">    dav_ext_methods PROPFIND OPTIONS;</span><br><span class="line">    dav_access      user:rw group:rw all:r;</span><br><span class="line"></span><br><span class="line">	# 临时中转目录，提高安全性；亦可取消</span><br><span class="line">    client_body_temp_path   /tmp/nginx/client-bodies;</span><br><span class="line">    </span><br><span class="line">    # 上传文件的最大容量限制，0为不限制</span><br><span class="line">    client_max_body_size    0;</span><br><span class="line">    </span><br><span class="line">    create_full_put_path    on;</span><br><span class="line"></span><br><span class="line">	# 注意建立目录并给 www-data 权限</span><br><span class="line">    root /opt/webdav; </span><br><span class="line">&#125;</span><br><span class="line">创建账号认证文件</span><br><span class="line">开启 gzip</span><br><span class="line"></span><br><span class="line">$ sudo sed -i &apos;/gzip_/ s/#\ //g&apos; /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line"># 创建新用户</span><br><span class="line">$ echo -n &apos;maindav:&apos; | sudo tee /etc/nginx/.passwords.list</span><br><span class="line"></span><br><span class="line"># 设定用户密码</span><br><span class="line">$ openssl passwd -apr1 | sudo tee -a /etc/nginx/.passwords.list</span><br><span class="line">Password: # 输入用户的密码</span><br><span class="line"> chown -R www-data:www-data  /mnt/mesos/sandbox</span><br></pre></td></tr></table></figure>
<div id="paginator"></div></div><div id="post-footer"><hr><a href="/2019/07/18/yahoo邮箱大坑/">← Prev yahoo使用记录</a><span style="color: #fe2"> | </span><a href="/2019/05/30/aria2/">aria2使用记录 Next →</a><hr></div><div id="bottom-btn"><a id="to-index" href="#post-index" title="index">≡</a><a id="to-top" href="#post-title" title="to top">∧</a></div><details id="reward"><summary>打赏</summary><div id="alipay"><span>支付宝 | Alipay</span><br><img src="/img/Alipay.png"></div><div id="wechat"><span>微信 | WeChat</span><br><img src="/img/WeChat.png"></div></details><div id="Valine"></div><script>new Valine({
 el: '#Valine'
 , appId: ''
 , appKey: ''
 , placeholder: '此条评论委托企鹅物流发送'
})</script></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/"> Dr.bin</a></h1><section id="total"><a id="total-archives" href="/archives"><span class="total-title">Archives Total:</span><span class="total-number">22</span></a><div id="total-tags"><span class="total-title">Tags:</span><span class="total-number">0</span></div><div id="total-categories"><span class="total-title">Categories:</span><span class="total-number">0</span></div></section></div><div id="aside-block"><h1>INDEX</h1><div id="post-index"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#安装nginx过程以及webdav"><span class="toc-number">1.</span> <span class="toc-text">安装nginx过程以及webdav</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#准备工作"><span class="toc-number">1.1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开始安装"><span class="toc-number">1.2.</span> <span class="toc-text">开始安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTPs的简单配置"><span class="toc-number">1.3.</span> <span class="toc-text">HTTPs的简单配置</span></a></li></ol></li></ol></div></div><footer><nobr><span class="text-title">©</span><span class="text-content">1970 to 2020</span></nobr><wbr><nobr><span class="text-title">ICP</span><span class="text-content">——备案号——</span></nobr><wbr><wbr><nobr>published with&nbsp;<a href="http://hexo.io">Hexo&nbsp;</a></nobr><wbr><nobr>Theme&nbsp;<a href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight&nbsp;</a></nobr><wbr><nobr>by&nbsp;<a href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/arknights.js"></script></body></html>